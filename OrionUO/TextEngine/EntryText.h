/***********************************************************************************
**
** EntryText.h
**
** Copyright (C) August 2016 Hotride
**
************************************************************************************
*/
//----------------------------------------------------------------------------------
#ifndef ENTRYTEXT_H
#define ENTRYTEXT_H
//----------------------------------------------------------------------------------
#include "../Globals.h"
#include "../GLEngine/GLTextTexture.h"
//----------------------------------------------------------------------------------
class CGump;
//----------------------------------------------------------------------------------
//!Класс для работы с полем для ввода текста
class CEntryText
{
	SETGET(int, MaxLength);
	SETGET(int, Width);
	SETGET(int, MaxWidth);
	SETGET(bool, Changed);
	SETGET(ushort, Color);
	SETGET(int, DrawOffset);
	SETGET(POINT, CaretPos);
	SETGET(bool, NumberOnly);

private:
	//!Unicode строка
	wstring m_Text;

	//!ASCII строка
	string m_CText;

	//!Позиция каретки в строке
	int m_Position;

public:
	CEntryText(int maxLength = 0, int width = 0, int maxWidth = 0, bool numberOnly = false);
	virtual ~CEntryText();

	//!Текстура текста
	CGLTextTexture m_Texture;

	/*!
	Очистить данные
	@return 
	*/
	void Clear();

	//Получить количество строк
	int GetLinesCountA(uchar font, TEXT_ALIGN_TYPE align = TS_LEFT, ushort flags = 0, int width = 0);

	//Получить количество строк
	int GetLinesCountW(uchar font, TEXT_ALIGN_TYPE align = TS_LEFT, ushort flags = 0, int width = 0);

	//Вставить символ
	bool Insert(wchar_t ch, CGump *gump = NULL);

	//Удалить символ
	void Remove(bool left, CGump *gump = NULL);

	//Сместить позицию каретки в тексте
	void AddPos(int val, CGump *gump = NULL);

	//Установить позицию каретки в тексте
	void SetPos(int val, CGump *gump = NULL);

	//Unicode данные строки
	const wchar_t *Data() const {return m_Text.c_str();}

	//ASCII данные стоки
	const char *c_str();

	//Установить ASCII текст
	void SetText(const string &text);

	//Установить Unicode текст
	void SetText(const wstring &text);

	//Событие нажатия мышкой на текст
	void OnClick(CGump *gump, uchar font, bool unicode, int x, int y, TEXT_ALIGN_TYPE align = TS_LEFT, ushort flags = 0);

	//Нажатие клавиши в активном текстовом поле
	void OnKey(CGump *gump, WPARAM wParam);

	int Pos() const {return m_Position;}

	int Length() const {return m_Text.length();}

	//Вычислить ASCII строку по ширине
	string CheckMaxWidthA(uchar font, string str);

	//Вычислить Unicode строку по ширине
	wstring CheckMaxWidthW(uchar font, wstring str);

	//Отформатировать ASCII текст по ширине
	void FixMaxWidthA(uchar font);

	//Отформатировать Unicode текст по ширине
	void FixMaxWidthW(uchar font);

	//Создать текстуру ASCII текста
	void CreateTextureA(uchar font, string str, ushort color, int width, TEXT_ALIGN_TYPE align, ushort flags);

	//Создать текстуру Unicode текста
	void CreateTextureW(uchar font, wstring str, ushort color, int width, TEXT_ALIGN_TYPE align, ushort flags);

	//Отрисовать ASCII текст
	virtual void DrawA(uchar font, ushort color, int X, int Y, TEXT_ALIGN_TYPE align = TS_LEFT, ushort flags = 0);

	//Отрисовать Unicode текст
	virtual void DrawW(uchar font, ushort color, int X, int Y, TEXT_ALIGN_TYPE align = TS_LEFT, ushort flags = 0);

	//Отрисовать ASCII текст замаскированный звездочками
	void DrawMaskA(uchar font, ushort color, int X, int Y, TEXT_ALIGN_TYPE align = TS_LEFT, ushort flags = 0);

	//Отрисовать Unicode текст замаскированный звездочками
	void DrawMaskW(uchar font, ushort color, int X, int Y, TEXT_ALIGN_TYPE align = TS_LEFT, ushort flags = 0);
};
//----------------------------------------------------------------------------------
extern CEntryText *g_EntryPointer;
//----------------------------------------------------------------------------------
#endif
//----------------------------------------------------------------------------------
